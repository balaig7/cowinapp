<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="Cowin web app lists all vaccinnation providers based on your cities in india">
      <meta name="keywords" content="cowin web app,cowin web app india,covid 19 vaccination providers near me,cowin web app github">
      <title>Cowin App</title>
      <!-- css -->
      <link rel="stylesheet" href="assets/css/bootstrap.min.css">
      <link href="assets/css/select2.min.css" rel="stylesheet" />
      <link rel="stylesheet" type="text/css" href="assets/css/dataTables.bootstrap5.min.css">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/fontawesome.min.css" integrity="sha384-jLKHWM3JRmfMU0A5x5AkjWkw/EYfGUAGagvnfryNV3F9VqM98XiIH7VBGVoxVSc7" crossorigin="anonymous">
   </head>
   <body class="bg-light">
      <div class="container p-3">
        <div class="row">
         <div class="all-states col-lg-6 col-sm-12 mb-3">
         </div>
         <div class="districts col-lg-6 col-sm-12">
         </div>
        </div>
         <div class="hospitals mt-4 col">
         </div>
      </div>
   </body>
   <!-- js -->
  <script src="assets/js/jquery-3.6.0.min.js"></script>
  <script src="assets/js/bootstrap.min.js"></script>
  <script  src="assets/js/jquery.dataTables.min.js"></script>
  <script src="assets/js/dataTables.bootstrap5.min.js"></script>
  <script src="assets/js/select2.min.js"></script>
  <script type="text/javascript">
      $(document).ready(function(){
      	getStates();
      	function getStates(){
      		$.ajax({
      			url:"https://cdn-api.co-vin.in/api/v2/admin/location/states",
      			method:"get",
      			contentType: "application/json; charset=utf-8",
      			success:function(data){
      			var states=''
      			states+='<h5>SELECT STATE</h5>'
            		states+='<div class="form-group">'
            		states+='<select class="form-select states" aria-label="Default select example">'
        		states+='<option>Choose State</option>'
      			$.each(data.states,function(index,value){
        			states+='<option value="'+value.state_id+'">'+value.state_name+'</option>'
      			})
      			states+='</div>'
            		states+='</select>'
      			$('.all-states').html(states)
      	    		$('.states').select2();
      			}
      		})
      	}
      	$(document).on('change','.states',function(){
      	   var state_id=$(this).val();
      	   var districts=''
      		$.ajax({
      			url:"https://cdn-api.co-vin.in/api/v2/admin/location/districts/"+state_id,
      			method:"get",
      			contentType: "application/json; charset=utf-8",
      			success:function(data){
      				districts+='<h5>SELECT DISTRICT</h5>'
              			districts+='<div class="form-group">'
      				districts+='<select class="form-select all-districts">'
        			districts+='<option>Choose District</option>'
      			 $.each(data.districts,function(index,value){
        			districts+='<option value="'+value.district_id+'">'+value.district_name+'</option>'
      			 })
      			 districts+='</div>'
            		 districts+='</select>'
      			$('.districts').html(districts)
      			$('.all-districts').select2()
      			}
      		})
      	})
      })
      $(document).on('change','.all-districts',function(){
      	var district_id=$(this).val()
      		var form=''
      		  form+='<div class="modal fade" id="availability-modal" tabindex="-1"  aria-hidden="true">'
  		  form+='<div class="modal-dialog">'
		  form+='<div class="modal-content">'
		  form+='<div class="modal-header">'
		  form+='<h5 class="modal-title" id="exampleModalLabel">Choose Date</h5>'
		  form+='<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>'
		  form+='</div>'
		  form+='<div class="modal-body">'
		  form+='<form class="show-hospital">'
		  form+='<div class="mb-3">'
		  form+='<label class="col-form-label">Choose Date:</label>'
		  form+='<input type="date" class="form-control available-date">'
		  form+='</div>'
		  form+='</form>'
		  form+='</div>'
		  form+='<div class="modal-footer">'
		  form+='<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>'
		  form+='<button type="button" class="btn btn-primary" onclick="showHospitals('+district_id+')">Submit</button>'
		  form+='</div>'
		  form+='</div>'
		  form+='</div>'
		  form+='</div>'
          $(form).modal('show');
      })

      function showHospitals(district_id){
  			var date=$('.available-date').val()
  			var newDate = date.split("-").reverse().join("-");
  			var hospitals=''
  			$.ajax({
				url:"https://cdn-api.co-vin.in/api/v2/appointment/sessions/public/findByDistrict?district_id="+district_id+"&date="+newDate+"",
				method:"get",
				contentType: "application/json; charset=utf-8",
				success:function(data){
					$('#availability-modal').modal('hide');
					$('#availability-modal').remove();
					$('html,body').animate({scrollTop: $(".hospitals").offset().top},'1000');
				date=''
				  hospitals+='<div class="card">'
      		hospitals+='<div class="card-header border border-primary bg-primary">'
          	hospitals+='<h3 class="mb-0 text-white">Hospitals</h3>'
          	hospitals+='</div>'
      		hospitals+='<div class="table-responsive p-3">'
        	hospitals+='<table class="table table-hover datatable">'
      		hospitals+='<thead>'
      		hospitals+='<th>S.No</th>'
      		hospitals+='<th>Name</th>'
      		hospitals+='<th>Address</th>'
    			hospitals+='<th>Block Name</th>'
    			hospitals+='<th>Fee Type</th>'
    			hospitals+='<th>Dose 1</th>'
    			hospitals+='<th>Dose 2</th>'
    			hospitals+='<th>Amount</th>'
    			hospitals+='<th>Age Limit</th>'
    			hospitals+='<th>Vaccine</th>'
    			hospitals+='<th>Available Timings</th>'
    			hospitals+='</thead>'
    			hospitals+='<tbody>'
      			$.each(data.sessions,function(index,value){
          			hospitals+='<tr>'
          			hospitals+='<td>'+(index+1)+'</td>'
          			hospitals+='<td>'+value.name+'</td>'
          			hospitals+='<td>'+value.address+'</td>'
          			hospitals+='<td>'+value.block_name+'</td>'
          			hospitals+='<td>'
          			hospitals+=value.fee_type=="Free" ?
          			'<span class="badge rounded-pill bg-success">Free</span>' :'<span class="badge rounded-pill bg-danger">Paid</span>'
          			hospitals+='</td>'
          			hospitals+='<td>'+value.available_capacity_dose1+'nos</td>'
          			hospitals+='<td>'+value.available_capacity_dose2+'nos</td>'
          			hospitals+='<td>â‚¹'+value.fee+'</td>'
          			if(value.max_age_limit==undefined){
          				value.max_age_limit='& above'
          			}else{
          				value.max_age_limit='-' +value.max_age_limit
          			}
          			hospitals+='<td>'+value.min_age_limit+value.max_age_limit+'</td>'
          			hospitals+='<td>'+value.vaccine+'</td>'
          			hospitals+='<td>'
          			$.each(value.slots,function(ind,availableslots){
          			   hospitals+='<p class="border border-primary p-2">'+availableslots+'<p>'
          			})
          			hospitals+='</td>'
        			  hospitals+='</tr>'
      			})
      			hospitals+='</tbody>'
      			hospitals+='</table>'
      			hospitals+='</div>'
      			hospitals+='</div>'
      			$('.hospitals').html(hospitals)
      			$('.datatable').dataTable({
    				"language": {
      				"emptyTable": "No vaccination providers are available in this date"
    				}
    			})
			}
			})
		}   
  </script>
</html>
